# 同城配送管理系统 — 功能详细描述

## 一、登录管理模块

### 
模块功能说明：
该模块为系统的入口模块，负责用户身份验证与权限控制，确保不同角色进入对应的功能模块。

主要功能描述：

1. 权限控制：
   - 系统根据用户身份区分配送员和系统管理员。
   - 配送员无法访问系统管理模块；管理员拥有系统的最高访问权限。

2. 登录错误信息提示：
   - 当用户输入错误的用户名或密码时，系统弹出相应错误提示信息。
   - 支持多次登录失败后的提示或限制登录操作（选做）。

### 功能 1：权限控制

**功能概述：**  
系统根据用户身份（配送员、系统管理员）进行访问权限控制。  
配送员仅能访问配送员模块；管理员可访问系统管理模块。  
此功能确保不同角色在系统中的操作边界，防止越权访问。

**输入：**

| 输入项 | 类型 | 说明 |
| --- | --- | --- |
| 用户名 | 字符串 | 用户输入的账户名 |
| 密码 | 字符串 | 用户输入的登录密码 |

**输出：**

| 输出项 | 类型 | 说明 |
| --- | --- | --- |
| 登录验证结果 | 布尔 | 表示验证是否通过 |
| 用户角色 | 枚举 | 系统识别的用户角色：`deliveryman` / `admin` |
| 跳转页面 | 页面 | 登录后根据角色跳转的目标模块主页 |

**主要流程：**

1. 用户输入用户名与密码提交登录请求。
2. 系统从数据库中验证用户名与密码是否匹配。
3. 若验证成功，系统判断该用户的角色类型：
   - 配送员：跳转至配送员模块；
   - 系统管理员：跳转至系统管理模块。
4. 若验证失败，则触发登录错误提示流程。
5. 权限控制模块在后续操作中持续生效，防止访问非授权页面。

**数据需求：**

| 数据表 | 主要字段 | 说明 |
| --- | --- | --- |
| `user` | user_id, username, password, role, status | 存储所有用户信息及其角色身份 |
| **关系** | - | `role` 用于区分用户类型（配送员、管理员） |

---

### 功能 2：登录错误信息提示

**功能概述：**  
在用户登录失败时，系统应返回明确的错误提示信息，帮助用户了解失败原因。  
可选功能包括：限制连续登录失败次数、防止暴力破解。

**输入：**

| 输入项 | 类型 | 说明 |
| --- | --- | --- |
| 用户名 | 字符串 | 登录时输入的账户名 |
| 密码 | 字符串 | 登录时输入的密码 |

**输出：**

| 输出项 | 类型 | 说明 |
| --- | --- | --- |
| 提示信息 | 字符串 | 登录失败原因（如“用户名不存在”或“密码错误”） |
| 登录状态 | 枚举 | 成功 / 失败 / 被锁定 |
| 剩余尝试次数（选做） | 数值 | 距离账号暂时锁定的剩余尝试次数 |

**主要流程：**

1. 用户提交登录信息后，系统验证用户名与密码。
2. 若用户名不存在，返回“用户不存在”提示。
3. 若密码错误，返回“密码错误”提示，并记录失败次数。
4. 若失败次数超过设定阈值（如3次），可临时锁定账户并提示用户稍后重试（选做）。
5. 登录成功后，系统清空该用户的登录错误计数。

**数据需求：**

| 数据表 | 主要字段 | 说明 |
| --- | --- | --- |
| `login_log`（选做） | user_id, attempt_time, success_flag, fail_count | 记录用户登录行为，用于限制连续失败登录 |
| `user` | user_id, username, password, status | 存储登录凭证及账户状态 |

---

## 二、系统管理模块

###
模块功能说明：
该模块为系统的核心管理后台，仅供具有“系统管理员”角色的用户访问。管理员在此模块中完成账号管理、订单生命周期管理以及数据统计分析工作，确保整个配送流程的顺畅与可控。

主要功能描述：

1.  账号管理：系统管理员能够对管理员账号和配送员账号进行全面的增、删、改、查及密码重置操作。
2.  发布配送信息：管理员可创建新的配送订单，填写详细的收发货地址、费用等信息，订单初始状态为"待接单"，进入抢单池。
3.  跟踪配送信息：管理员能够根据订单号、客户信息等多种条件查询订单，并实时跟踪其配送状态（如：待接单、配送中、已完成、取消）。
4.  历史配送信息查阅与统计：管理员能够查阅所有历史配送记录，并基于这些数据进行多维度统计。

### 功能1：账号管理

**功能概述：**  
系统管理员通过该功能对两类账号进行全生命周期管理，包括管理账号的增删改查、密码修改，以及配送员账号的创建、信息维护、状态管理（如启用/禁用），确保账号权限与业务角色精准匹配，避免越权操作。

**输入：**

| 输入项 | 类型 | 说明 |
| --- | --- | --- |
| 账号 ID | 字符串 / 数值 | 唯一标识，修改 / 删除 / 查询时必填|
|用户名 | 字符串 | 6-20 位字母 / 数字组合，不可重复 |
| 初始密码 / 新密码 | 字符串 | 8-20 位含字母 + 数字 + 特殊符号 |
|用户角色 | 枚举 | 固定为admin（管理账号）或deliveryman（配送员账号） |
| 配送员联系方式 | 字符串 | 11 位手机号，仅配送员账号需填写 |
|账号状态 | 枚举 | enabled（启用）/disabled（禁用） |

**输出：**

| 输出项 | 类型 | 说明 |
| --- | --- | --- |
| 操作结果提示 | 字符串 | 如 “账号新增成功”“用户名已存在”“密码修改成功” |
| 账号列表 | 列表 | 展示账号 ID、用户名、角色、状态、联系方式、创建时间 |
| 账号详情 | 对象 | 单个账号的完整信息（含加密后的密码，不可明文展示） |
| 操作日志（选做） | 字符串 | 记录 “谁在什么时间执行了什么操作”，用于追溯 |

**主要流程：**

1. 账号新增流程
   - 管理员选择账号类型（管理账号/配送员账号），填写用户名、初始密码、联系方式（仅配送员）等信息；
   - 系统校验用户名唯一性（查询user表），若已存在则返回错误提示；
   - 校验通过后，对密码进行加密处理，将账号信息存入user表，状态默认设为“启用”；
   - 返回“新增成功”提示，并刷新账号列表。
2. 账号查询/修改/删除流程
   - 查询：管理员输入账号ID、用户名或用户角色筛选，系统从user表查询匹配数据，以列表形式展示；
   - 修改：管理员点击目标账号“修改”按钮，修改允许变更的字段（如密码、联系方式、状态），系统校验后更新user表，返回成功提示；
   - 删除：管理员选择目标账号“删除”，系统校验该账号是否存在未完成的关联业务（如配送员账号是否有“配送中”任务），若无则删除user表中对应记录，若有则提示“存在未完成业务，无法删除”。
3. 密码修改流程
   - 管理员选择目标账号（或自己的账号），输入原密码（修改自身密码时）和新密码；
   - 系统校验原密码正确性（仅自身密码修改需校验），新密码符合复杂度要求后，加密更新user表中 password字段；
   - 返回“密码修改成功”提示。

**数据需求：**

| 数据表 | 主要字段 | 说明 | 与其他模块关联 |
| --- | --- | --- | --- |
| `user` | user_id,username, password,role,status, contact_info（联系信息）,create_time（创建时间）,creator_id（创建人 ID ） | 存储所有用户账户信息。role 用于区分用户类型（配送员、管理员），status字段标识账号状态（启用/禁用）。 | 与登录管理模块共用该表 |
| `operation_log`（选做） | log_id, operator_id, operation_type, operation_obj, operation_time, result | 记录账号操作日志 | operator_id关联user表的user_id（操作人），operation_obj关联被操作账号的user_id |

---

### 功能2：发布配送信息

**功能概述：**  
系统管理员作为配送需求的发起方，通过该功能录入接货地址、配送地址、配送费用等核心信息，生成初始状态为“待接单”的配送单；可选将该功能封装为WEB SERVICE接口，供第三方应用（如商家系统）调用，实现配送需求的批量/自动接入。

**输入：**

| 输入项 | 类型 | 说明 | 必要性 |
| --- | --- | --- | --- |
|接货地址 | 字符串 | 含省、市、区、详细地址 | 必选 |
| 接货人姓名 | 字符串 | 接收货物的联系人姓名 | 必选 |
| 接货人电话 | 字符串 | 11 位手机号，用于联系接货 | 必选 |
| 配送地址 | 字符串 | 格式同接货地址，为货物最终送达地址 | 必选 |
| 收货人姓名 | 字符串 | 接收货物的联系人姓名 | 必选 |
| 收货人电话 | 字符串 | 11 位手机号，用于联系收货 | 必选 |
| 配送费用 | 数值 | 单位：元，保留 2 位小数 | 必选 |
| 货物类型 | 枚举 | ordinary（普通货物）/fragile（易碎品）/fresh（生鲜） | 必选 |
| 预计配送时效 | 数值 | 单位：小时 | 可选 |
| 货物重量 / 体积 | 数值 | 重量单位：kg，体积单位：m³，用于配送员参考 | 可选 |
| 备注信息 | 字符串 | 如 “需当面签收” “请勿挤压” | 可选 |

**输出：**

| 输出项 | 类型 | 说明 |
| --- | --- | --- |
| 配送单编号 | 字符串 | 唯一标识（如 “DEL20251012001”，含日期 + 流水号） |
| 发布结果提示 | 字符串 | 如 “配送单发布成功，待配送员接单” |
| WEB SERVICE 接口响应（选做）（选做） | JSON/XML | 含code（状态码）、msg（提示）、order_id（配送单编号） |
| 配送单详情页） | 页面 | 展示已发布配送单的所有信息，状态标注为 “待接单” |

**主要流程：**
1.  管理员进入“配送信息发布”页面，填写完整的表单信息。
2.  点击“提交”后，系统对必填字段（如地址、联系方式）进行格式校验。
3.  校验通过后，系统生成唯一配送单编号（规则：前缀“DEL"+日期+3位流水号），将信息存入delivery_order表，状态设为“待接单”（status="pending"）。
4.  系统将订单数据持久化到数据库，并展示“发布成功”提示及配送单编号。
5.  （选做）WebService接口：提供标准接口，第三方系统传入规范参数即可创建订单，返回相同结构的响应。

**数据需求：**

| 数据表 | 主要字段 | 说明 | 与其他模块关联 |
| --- | --- | --- | --- |
| `delivery_order` | order_id（配送单编号）, pickup_addr, pickup_name, pickup_phone, delivery_addr, delivery_name, delivery_phone,fee, goods_type, expected_time, weight, volume, remark, status, create_time, creator_id | 存储配送单核心信息。status记录订单生命周期状态。 | creator_id关联user表的user_id（发布人，即管理员），后续配送员模块需读取该表“待接单”数据 |
| `api_key`（选做） |key_id, app_name, api_key, status, create_time | 存储第三方应用的接口密钥 | 用于 WEB SERVICE 接口的身份验证，仅状态为“启用”的密钥可调用接口 |

---

### 功能3：跟踪配送信息

**功能概述：**  
系统管理员通过该功能实时查询配送单的当前状态（待接单/配送中/已完成/取消），并查看配送全流程节点信息（如“谁接单”“何时开始配送”“何时送达”），支持按多条件组合查询，确保对配送进度的实时管控。

**输入：**

| 输入项 | 类型 | 说明 | 查询逻辑 |
| --- | --- | --- | --- |
| 配送单编号 | 字符串 | 精确匹配（如 “DEL20251012001”） | 输入后优先按编号查询，结果唯一 |
| 接货人电话 | 字符串 | 11 位手机号，模糊匹配 | 可单独输入，或与其他条件组合 |
| 收货人电话 | 字符串 | 11 位手机号，模糊匹配 | 可单独输入，或与其他条件组合 |
| 配送员 ID / 姓名 | 字符串 | 匹配配送员账号的user_id或username | 仅查询该配送员负责的配送单 |
| 配送状态 | 枚举 | pending（待接单）/delivering（配送中）/completed（已完成）/cancelled（取消） | 筛选指定状态的配送单|
| 时间范围 | 日期区间 | 如“2025-10-01 至 2025-10-12” | 筛选该时间段内创建的配送单 |

**输出：**

| 输出项 | 类型 | 说明 |
| --- | --- | --- |
| 配送单列表 | 列表 | 展示匹配条件的所有配送单，含订单号、接货地址（脱敏，如“北京市海淀区 ***”）、配送状态、创建时间 |
| 配送单详情 | 对象 | 点击列表项后展示，含所有字段（地址、联系人、货物类型、费用）+ 配送节点信息（接单时间、配送员、送达时间） |
| 空结果提示 | 字符串 | 如“未查询到符合条件的配送单，请调整查询条件” |

**主要流程：**
1.  管理员进入“配送信息跟踪”页面，选择查询条件（如输入配送单编号，或选择状态为“配送中”+时间范围）。
2.  点击“查询”按钮，系统根据输入条件拼接SQL查询语句，从delivery_order表和delivery_trace表（跟踪节点）关联查询。
3.  若有匹配数据，以列表形式展示核心信息；若无可匹配数据，返回空结果提示。
4.  管理员点击某配送单编号，跳转至详情页，系统展示该配送单的完整信息及所有跟踪节点（如“2025-10-12 10:00 配送单创建，待接单”“2025-10-12 10:30 配送员张三接单，状态变更为配送中”）。

**数据需求：**

| 数据表 | 主要字段 | 说明 | 与其他模块关联 |
| --- | --- | --- | ---|
| `delivery_order` | order_id, pickup_addr, pickup_name, pickup_phone, delivery_addr, delivery_name, delivery_phone, fee, goods_type, status, create_time | 存储配送单基础信息 | 与配送员模块共用，配送员接单 / 完成后会更新status字段 |
| `delivery_trace` | trace_id, order_id, status, operator_id, operate_time, remark | 存储配送单状态变更的节点信息 | order_id关联delivery_order表的order_id，operator_id关联user表的user_id（操作人，如接单的配送员） |
| `user` |user_id, username, contact_info| 存储配送员姓名、联系方式 | 详情页展示“配送员信息”时，通过operator_id关联查询 |

---

### 功能4：历史配送信息查阅与统计

**功能概述：**  
系统管理员通过该功能查询所有已完成/已取消的历史配送单，并基于历史数据生成统计报表（如指定时间段内的总订单量、完成率、平均配送时长、各区域订单分布），支持数据导出（选做），为业务优化提供数据支撑。

**输入：**

| 输入项 | 类型 | 说明 | 统计维度关联 |
| --- | --- | --- | --- |
| 统计时间范围 | 日期区间 | 如“2025-09-01 至 2025-09-30” | 核心筛选条件，所有统计基于该时间段 |
| 配送状态 | 枚举 | 仅completed（已完成）/cancelled（取消） | 筛选历史订单的状态范围 |
| 区域范围 | 字符串 | 如“北京市海淀区”“上海市” | 按接货 / 配送地址的区域筛选 |
| 货物类型 | 枚举 | ordinary/fragile/fresh | 按货物类型分类统计 |

**输出：**

| 输出项 | 类型 | 说明 |
| --- | --- | --- |
| 历史配送单列表 | 列表 | 展示符合条件的历史订单，含订单号、状态、接货 / 配送地址、费用、完成 / 取消时间 |
| 统计汇总表 | 表格 | 展示核心统计指标：总订单数、完成订单数、取消订单数、完成率（完成数 / 总数）、平均配送时长（完成订单的时长均值） |
| 统计图表（选做） | 饼图 / 柱状图 | 饼图：展示各状态订单占比；柱状图：展示每日订单量 / 各区域订单量；折线图：展示订单量趋势 |
| 数据导出文件（选做） | Excel/CSV | 包含历史订单列表或统计汇总表的完整数据，支持管理员下载 |


**主要流程：**
 1. 历史配送单查阅流程
   - 管理员进入“历史配送信息”页面，选择时间范围（默认近30天）、状态（默认“已完成”）等条件；
   - 点击“查询”，系统从delivery_order表查询状态为“已完成/取消”且在时间范围内的订单；
   - 以列表形式展示，支持按“完成时间”降序排序，管理员可点击订单号查看详情。
 2. 统计流程
   - 管理员在查阅页面点击“生成统计报表”，系统基于当前查询条件计算核心指标：
       - 总订单数：符合条件的订单总量；
       - 完成率：（完成订单数/总订单数）x100%；
       - 平均配送时长：所有完成订单的“送达时间-接单时间”的均值；
   - 系统以表格形式展示统计结果，可选生成饼图/柱状图（调用ECharts、Highcharts等插件）；
   - 管理员可点击“导出数据”，系统将统计结果或历史订单列表生成Excel/CSV文件供下载（选做）。

**数据需求：**

| 数据表 | 主要字段 | 说明 | 统计逻辑依赖 |
| --- | --- | --- | --- |
| `delivery_order` | order_id, status, create_time, complete_time, cancel_time, pickup_addr, delivery_addr, goods_type, fee | 存储历史订单的核心数据 | 时间范围依赖create_time，状态依赖status，区域统计依赖pickup_addr/delivery_addr |
| `delivery_trace` |order_id, status, operate_time | 存储状态变更时间 | 平均配送时长计算依赖“接单时间”（status="delivering"的operate_time）和“完成时间”（status="completed"的operate_time） |
| `user` | user_id, username | 存储配送员信息 | 可选按“配送员”维度统计时，关联delivery_trace表的operator_id查询姓名 |

---


# 同城配送管理系统 - 配送员模块详细设计

## 一、模块功能说明

该模块为系统中与“配送员”角色直接相关的业务核心子系统，实现从登录认证、个人信息管理、任务处理、记录查询到通知提醒的完整闭环。模块设计遵循安全、可维护、易扩展的原则，确保配送端业务高效运行。

主要功能描述：

1. 登录与安全认证：通过账号密码登录、权限控制及会话管理实现安全接入。  
2. 个人信息管理：配送员可查看和修改个人信息、密码以及工作状态。  
3. 配送任务处理：支持自动抢单、手动抢单、订单状态更新及异常处理。  
4. 配送记录查询：提供当前订单与历史订单的查看与统计功能。  
5. 系统通知：实现管理员及订单状态消息的实时提醒。

---

## 功能1：登录与安全认证

**功能概述：**  
配送员通过系统登录页面输入管理员分配的账号和初始密码进入系统，系统校验账号的有效性与访问权限，登录成功后自动创建会话，并根据角色标识分配模块访问权限。

**输入：**

| 输入项 | 类型 | 说明 |
| --- | --- | --- |
| 用户名 | 字符串 | 管理员分配账号，唯一且区分权限 |
| 密码 | 字符串 | 6–20 位字母+数字组合，通过 MD5 加密传输 |
| 记住用户名 | 布尔值 | 是否在 Cookie 中保存用户名（有效期 7 天） |

**输出：**

| 输出项 | 类型 | 说明 |
| --- | --- | --- |
| 登录结果 | 字符串 | “登录成功”“账号已禁用”“密码错误”“账号锁定”等提示 |
| 会话信息 | 结构体 | 包含配送员 ID、用户名、角色标识、会话过期时间 |
| 权限跳转提示 | 页面 | 登录成功后根据角色进入对应模块，越权访问跳转至 403 页面 |

**主要流程：**

1. 输入用户名与密码提交请求。  
2. 系统校验账号存在性与状态（是否禁用/锁定）。  
3. 若有效，则验证密码正确性；连续登录失败超过 5 次自动锁定账号 1 小时。  
4. 校验通过，创建 Session（30 分钟有效），设置 Cookie“记住用户名”。  
5. 返回登录结果并跳转至配送员主页。  

**数据需求：**

| 数据表 | 主要字段 | 说明 | 与其他模块关联 |
| --- | --- | --- | --- |
| `delivery_man` | id, username, password, role_type, work_status, login_fail_count, account_lock_time, create_time, update_time | 存储配送员账号及状态信息 | 与系统通知、任务处理模块共用 |

---

## 功能2：个人信息管理

**功能概述：**  
配送员可在个人中心查看姓名、联系方式、工作状态、紧急联系人等信息，并执行手机号、密码修改及工作状态切换操作，确保个人资料的实时准确性。

**输入：**

| 输入项 | 类型 | 说明 |
| --- | --- | --- |
| 手机号 | 字符串 | 11 位手机号，用于联系与通知 |
| 紧急联系人 | 字符串 | 格式：“姓名 手机号” |
| 原密码 / 新密码 | 字符串 | 修改密码时必填，6–16 位含字母+数字 |
| 工作状态 | 枚举 | online（在线）/rest（休息）/offline（离线） |

**输出：**

| 输出项 | 类型 | 说明 |
| --- | --- | --- |
| 操作结果 | 字符串 | “修改成功”“原密码错误”“信息更新成功” |
| 信息展示 | 对象 | 当前配送员所有信息（可编辑字段标识） |

**主要流程：**

1. 配送员进入个人中心模块。  
2. 系统自动加载配送员信息并展示。  
3. 修改手机号或紧急联系人并提交后，系统校验数据格式和完整性，更新数据库。  
4. 修改密码时，系统验证原密码正确性，通过后加密保存新密码。  
5. 切换工作状态时，系统实时更新 work_status 字段，仅“在线”状态允许接单。  

**数据需求：**

| 数据表 | 主要字段 | 说明 |
| --- | --- | --- |
| `delivery_man` | id, phone, emergency_contact, password, work_status, update_time | 存储配送员个人信息 | 驱动任务处理模块的接单权限判断 |

---

## 功能3：配送任务处理

**功能概述：**  
该功能负责订单的接单、抢单及状态更新。模块支持自动抢单和手动抢单两种模式，包含异常处理与并发控制，确保配送任务分配正确性与事务一致性。

**输入：**

| 输入项 | 类型 | 说明 |
| --- | --- | --- |
| 抢单模式 | 枚举 | auto（自动）/manual（手动） |
| 订单编号 | 字符串 | 唯一订单标识 |
| 放弃原因 | 字符串 | 仅配送中/已取货状态可填写 |
| 异常上报类型 | 枚举 | lost_contact（联系不上收件人）/damaged（物品损坏） |

**输出：**

| 输出项 | 类型 | 说明 |
| --- | --- | --- |
| 抢单结果 | 字符串 | “抢单成功”“抢单失败”“申请待审核” |
| 订单状态 | 枚举 | pending / delivering / picked_up / completed / abort_pending / aborted / cancelled |
| 提示通知 | 消息 | 系统实时发出状态更新或异常通知 |

**主要流程：**

1. **抢单流程：**
   - 查询 system_config 中 autoGrabEnabled 状态；
   - 自动模式：系统检测配送员当前状态（必须在线且无配送中订单），锁定待接单订单；
   - 手动模式：提交抢单申请，管理员审核通过后分配订单。  

2. **状态更新流程：**
   - 接单 → 更新为“配送中”，记录接单时间 accept_time；
   - 取货 → 更新为“已取货”，记录 pick_up_time；
   - 完成 → 更新为“已完成”，记录 complete_time。  

3. **异常处理流程：**
   - 配送员可发起“放弃订单”申请（状态转为放弃待审核），管理员审核后决定是否退回待接单池；
   - 用户取消订单，系统通知配送员并自动计算 30% 补偿费用；
   - 配送员上报异常，系统生成通知并反馈管理员。  

**数据需求：**

| 数据表 | 主要字段 | 说明 | 与其他模块关联 |
| --- | --- | --- | --- |
| `order` | order_id, delivery_man_id, sender_addr, receiver_addr, status, fee, accept_time, pick_up_time, complete_time, cancel_reason, abort_reason | 存储订单生命周期数据 | 管理员模块、记录查询模块共享 |
| `system_config` | autoGrabEnabled, update_time | 控制抢单模式 | 管理员模块用于修改抢单方式 |
| `notification` | id, delivery_man_id, content, type, is_read, sms_sent | 异常及状态通知 | 与系统通知模块联动 |

---

## 功能4：配送记录查询

**功能概述：**  
配送员可查询当前订单和历史订单信息；系统支持异常标识、超时提示及统计展示，帮助配送员进行任务管理与绩效自评。

**输入：**

| 输入项 | 类型 | 说明 |
| --- | --- | --- |
| 时间范围 | 日期区间 | 查询近 7 天 / 30 天数据 |
| 状态筛选 | 枚举 | current（在途）/history（已完成/取消/放弃） |
| 排序条件 | 枚举 | byTime/byFee等 |

**输出：**

| 输出项 | 类型 | 说明 |
| --- | --- | --- |
| 当前订单列表 | 列表 | 展示配送中 / 已取货 / 放弃待审核订单 |
| 历史订单列表 | 列表 | 展示已完成 / 已取消 / 已放弃订单 |
| 异常标识 | UI | 超时标红、放弃 / 取消标注 |
| 统计信息 | 表格 | 今日 / 本月完成单量、平均耗时、补偿金额等 |

**主要流程：**

1. 读取当前 Session 中配送员 ID。  
2. 从 order 表查询当前订单状态 in（配送中、已取货、放弃待审核）。  
3. 从 order 表查询历史订单状态 in（已完成、配送员放弃、用户取消）。  
4. 设置界面显示：  
   - 当前订单突出展示收货地址并标超时；  
   - 历史订单按完成时间倒序排序，异常订单标红。  
5. 汇总统计指标并展示在个人概览区。  

**数据需求：**

| 数据表 | 主要字段 | 说明 | 与其他模块关联 |
| --- | --- | --- | --- |
| `order` | order_id, delivery_man_id, status, fee, accept_time, complete_time, estimated_time | 数据查询来源 | 任务处理模块更新状态 |
| `delivery_man` | id, name, work_status | 关联配送员信息 | 任务处理模块通用 |

---

## 功能5：系统通知

**功能概述：**  
为配送员推送来自系统与业务的实时通知，包括管理员操作、订单状态更新、异常反馈等，提高业务互动性与响应效率。

**输入：**

| 输入项 | 类型 | 说明 |
| --- | --- | --- |
| 通知类型 | 枚举 | admin_operate（管理员操作）/order_status（订单状态） |
| 通知内容 | 字符串 | 如“您的放弃订单申请已通过” |
| 短信开关 | 布尔值 | 是否发送短信提醒配送员 |

**输出：**

| 输出项 | 类型 | 说明 |
| --- | --- | --- |
| 通知列表 | 列表 | 当前配送员所有通知（含已读 / 未读状态） |
| 发送结果 | 字符串 | “短信发送成功”“通知已推送” |
| 阅读状态更新结果 | 布尔值 | 成功标记为已读时返回 true |

**主要流程：**
1. 系统内部触发订单或账号状态变化事件。  
2. 根据事件类型生成通知内容并写入 notification 表。  
3. 查询对应配送员联系方式并调用短信服务发送通知。  
4. 前端展示通知列表，配送员可点击“标记已读”。  

**数据需求：**

| 数据表 | 主要字段 | 说明 | 与其他模块关联 |
| --- | --- | --- | --- |
| `notification` | id, delivery_man_id, content, type, is_read, create_time, sms_sent | 存储所有通知信息 | 与个人信息及任务模块联动 |
| `delivery_man` | id, phone, email | 用于短信 / 邮件通知 | 登录及账号表通用 |

---

